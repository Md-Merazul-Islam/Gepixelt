<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Checkout</h1>

    <!-- Checkout button to initiate the payment -->
    <button id="checkout-button">Checkout</button>

    <!-- Placeholder to display the session ID -->
    <p id="session-id-display"></p>  <!-- This will show the session ID -->

    <script type="text/javascript">
        var stripe = Stripe('pk_test_51QZEaRCswZXaKM4ARthLO0sY7xHwqdxAV8tHRpXouzGhr8sFSwbM9ZfQUzKWljMSwdwXT3iltkoU1si2Ys114kp000bIO5hmxu');  // Replace with your Stripe public key
        var checkoutButton = document.getElementById('checkout-button');
        var sessionIdDisplay = document.getElementById('session-id-display');  // Reference to the paragraph to display session ID

        checkoutButton.addEventListener('click', function () {
            // Send a POST request to create a checkout session
            fetch('http://127.0.0.1:8000/api/v1/payment/checkout/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQyNzE5Nzk1LCJpYXQiOjE3NDI3MTM3OTUsImp0aSI6IjRhMzg3ZTllNGIxZDQ3M2Y4ZDA2YTlmMDViMTljNzlmIiwidXNlcl9pZCI6OSwidXNlcm5hbWUiOiJtZG1lcmF6dWw2NSIsImVtYWlsIjoibWRtZXJhenVsNjVAZ21haWwuY29tIiwicm9sZSI6InVzZXIifQ.6cdzAR6DyhGmAjgxnloC-atgiVwxhEKpFaEUX-w0XYk'  // Ensure the user is authenticated
                }
            })
            .then(function (response) {
                return response.json();  // Get the session data from the backend
            })
            .then(function (data) {
                if (data.error) {
                    alert(data.error);  // Show error if any
                    return;
                }
                // Show the session ID in the console and on the webpage
                console.log('Session ID:', data.id);  // Log the session ID in the console
                sessionIdDisplay.textContent = 'Session ID: ' + data.id;  // Display session ID in the paragraph
                // Redirect to Stripe Checkout page using the session ID
                return stripe.redirectToCheckout({ sessionId: data.id });
            })
            .then(function (result) {
                if (result.error) {
                    alert(result.error.message);
                }
            })
            .catch(function (error) {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
